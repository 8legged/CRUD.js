!function(a){"use strict";var b=function(a,b){if(a=a||{},arguments.length>2)for(var c=1;c<arguments.length;c++)window.extend(a,arguments[c]);else for(var d in b)a[d]=b[d];return a},c=function(d){this.conf=b({name:"database",indexedKeys:[],uniqueKey:"id",driver:new c.drivers.StorageDriver({name:d.name,storage:a.localStorage})},d||{}),this.initialize()};c.prototype.initialize=function(){this.data=this.load()||[],this.id=0,this.data.length>0&&(this.data=this.data.map(function(a){return parseInt(a,10)}),this.id=Math.max.apply(Math,this.data))},c.prototype.find=function(a){if("undefined"==typeof a)return this.findAll();var b,c=this.getKeys(a),e=[];for(var f in c[0])e.push(this.conf.driver.getItem(f+":"+c[0][f])||!1);return b=0===e.length?this.data:1===e.length?e[0]:d.apply(this,e),this.filter(this.select(b),c[1])},c.prototype.findAll=function(){return this.select(this.data)},c.prototype.getKeys=function(a){var b,c=[];c[0]={},c[1]={};for(var d in a)b=-1!==this.conf.indexedKeys.indexOf(d)?0:1,c[b][d]=a[d];return c},c.prototype.select=function(a){var b=[];a=1===a.length?[a]:a;for(var c=0,d=a.length;d>c;c++)b.push(this.conf.driver.getItem(a[c]));return b},c.prototype.filter=function(a,b){for(var c,d,e=[],f=0,g=a.length;g>f;f++){d=a[f],c=!0;for(var h in b)if(d[h]!==b[h]){c=!1;break}c&&e.push(d)}return e},c.prototype.insert=function(a){if("[object Object]"!==Object.prototype.toString.call(a))throw"Can't insert "+a+". Please insert object.";return this.id++,-1===this.data.indexOf(this.id)?(a[this.conf.uniqueKey]=this.id,this.data.push(this.id),this.conf.driver.setItem(this.id,a),this.conf.driver.setItem("__data",this.data.join(",")),this.buildIndex(a),this.id):void 0},c.prototype.update=function(a,b){return-1!==this.data.indexOf(a)?(this.destroyIndex(a),b[this.conf.uniqueKey]=a,this.conf.driver.setItem(a,b),this.buildIndex(b),b):void 0},c.prototype.delete=function(a){if("[object Object]"===Object.prototype.toString.call(a))this.findAndDelete(a);else if(-1!==this.data.indexOf(a))return this.data.splice(this.data.indexOf(a),1),this.destroyIndex(a),this.conf.driver.removeItem(a),this.conf.driver.setItem("__data",this.data.join(",")),-1===this.data.indexOf(a)},c.prototype.findAndDelete=function(a){for(var b,c=this.find(a),d=this.data.length,e=0;e<c.length;e++)b=c[e][this.conf.uniqueKey],-1!==this.data.indexOf(b)&&(this.data.splice(this.data.indexOf(b),1),this.destroyIndex(b),this.conf.driver.removeItem(b),this.conf.driver.setItem("__data",this.data.join(",")));return this.data.length<d},c.prototype.count=function(){return this.data.length},c.prototype.drop=function(){for(var a=0,b=this.data.length;b>a;a++)this.delete(this.data[a]);return this.conf.driver.removeItem("__data"),this.data.length=0,0===this.data.length},c.prototype.load=function(){return this.conf.driver.getItem("__data")?this.conf.driver.getItem("__data").split(","):null},c.prototype.buildIndex=function(a){var b,c,d;for(var e in a)-1!==this.conf.indexedKeys.indexOf(e)&&(d=[a[this.conf.uniqueKey]],b=e+":"+a[e],c=this.conf.driver.getItem(b),null!==c&&(c.push(a[this.conf.uniqueKey]),d=c),this.conf.driver.setItem(b,d))},c.prototype.destroyIndex=function(a){var b,c,d=this.conf.driver.getItem(a);if(null!==d)for(var e in d)-1!==this.conf.indexedKeys.indexOf(e)&&(b=e+":"+d[e],c=this.conf.driver.getItem(b),null!==c&&(c.splice(c.indexOf(a),1),0===c.length?this.conf.driver.removeItem(b):this.conf.driver.setItem(b,c)))};var d=function(){var a,b,c,d,e,f,g=[],h={};for(f=arguments.length-1,c=arguments[0].length,b=0,a=0;f>=a;a++)d=arguments[a].length,c>d&&(b=a,c=d);for(a=0;f>=a;a++){d=a===b?0:a||b,e=arguments[d].length;for(var i=0;e>i;i++){var j=arguments[d][i];h[j]===a-1?a===f?(g.push(j),h[j]=0):h[j]=a:0===a&&(h[j]=0)}}return g};a.Database=c,a.Database.drivers={};var e=function(b){if(this.conf=a.extend({name:"",storage:a.localStorage},b||{}),"function"!=typeof b.storage.getItem||"function"!=typeof b.storage.removeItem||"function"!=typeof b.storage.setItem)throw"Given Storage doesn't have methods `getItem`, `setItem` and `removeItem`."};e.prototype.setItem=function(a,b){return this.conf.storage.setItem(this.conf.name+":"+a,JSON.stringify(b))},e.prototype.getItem=function(a){return JSON.parse(this.conf.storage.getItem(this.conf.name+":"+a))},e.prototype.removeItem=function(a){return this.conf.storage.removeItem(this.conf.name+":"+a)},a.Database&&(a.Database.drivers.StorageDriver=e)}(window);