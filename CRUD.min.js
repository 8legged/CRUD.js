!function(a){"use strict";var b=function(c){this.conf=a.extend({name:"database",indexedKeys:[],uniqueKey:"id",driver:new b.drivers.StorageDriver({name:c.name,storage:a.localStorage})},c||{}),this.initialize()};b.prototype.initialize=function(){this.data=this.load()||[],this.id=0,this.data.length>0&&(this.data=this.data.map(function(a){return parseInt(a,10)}),this.id=Math.max.apply(Math,this.data))},b.prototype.find=function(a){if("undefined"==typeof a)return this.findAll();var b,d,e,f,g=[],h=[],i=[];for(var j in a)-1!==this.conf.indexedKeys.indexOf(j)?(b=this.conf.driver.getItem(j+":"+a[j]),h.push(null!==b?b:!1)):i.push(j);f=0===h.length?this.data:1===h.length?h[0]:c.apply(this,h);for(var k=0;k<f.length;k++){d=this.conf.driver.getItem(f[k]),e=!0;for(var l=0;l<i.length;l++)if(d[i]!==a[i]){e=!1;break}e&&g.push(d)}return g},b.prototype.findAll=function(){for(var a=[],b=0,c=this.data.length;c>b;b++)a.push(this.conf.driver.getItem(this.data[b]));return a},b.prototype.insert=function(a){if("[object Object]"!==Object.prototype.toString.call(a))throw"Can't insert "+a+". Please insert object.";return this.id++,-1===this.data.indexOf(this.id)?(a[this.conf.uniqueKey]=this.id,this.data.push(this.id),this.conf.driver.setItem(this.id,a),this.conf.driver.setItem("__data",this.data.join(",")),this.buildIndex(a),this.id):void 0},b.prototype.update=function(a,b){return-1!==this.data.indexOf(a)?(this.destroyIndex(a),b[this.conf.uniqueKey]=a,this.conf.driver.setItem(a,b),this.buildIndex(b),b):void 0},b.prototype.delete=function(a){if("[object Object]"===Object.prototype.toString.call(a))this.findAndDelete(a);else if(-1!==this.data.indexOf(a))return this.data.splice(this.data.indexOf(a),1),this.destroyIndex(a),this.conf.driver.removeItem(a),this.conf.driver.setItem("__data",this.data.join(",")),-1===this.data.indexOf(a)},b.prototype.findAndDelete=function(a){for(var b,c=this.find(a),d=this.data.length,e=0;e<c.length;e++)b=c[e][this.conf.uniqueKey],-1!==this.data.indexOf(b)&&(this.data.splice(this.data.indexOf(b),1),this.destroyIndex(b),this.conf.driver.removeItem(b),this.conf.driver.setItem("__data",this.data.join(",")));return this.data.length<d},b.prototype.count=function(){return this.data.length},b.prototype.drop=function(){for(var a=0,b=this.data.length;b>a;a++)this.delete(this.data[a]);return this.conf.driver.removeItem("__data"),this.data.length=0,0===this.data.length},b.prototype.load=function(){return this.conf.driver.getItem("__data")?this.conf.driver.getItem("__data").split(","):null},b.prototype.buildIndex=function(a){var b,c,d=[a[this.conf.uniqueKey]];for(var e in a)-1!==this.conf.indexedKeys.indexOf(e)&&(b=e+":"+a[e],c=this.conf.driver.getItem(b),null!==c&&(c.push(a[this.conf.uniqueKey]),d=c),this.conf.driver.setItem(b,d))},b.prototype.destroyIndex=function(a){var b,c,d=this.conf.driver.getItem(a);if(null!==d)for(var e in d)-1!==this.conf.indexedKeys.indexOf(e)&&(b=e+":"+d[e],c=this.conf.driver.getItem(b),null!==c&&(c.splice(c.indexOf(a),1),0===c.length?this.conf.driver.removeItem(b):this.conf.driver.setItem(b,c)))};var c=function(){var a,b,c,d,e,f,g=[],h={};for(f=arguments.length-1,c=arguments[0].length,b=0,a=0;f>=a;a++)d=arguments[a].length,c>d&&(b=a,c=d);for(a=0;f>=a;a++){d=a===b?0:a||b,e=arguments[d].length;for(var i=0;e>i;i++){var j=arguments[d][i];h[j]===a-1?a===f?(g.push(j),h[j]=0):h[j]=a:0===a&&(h[j]=0)}}return g};a.Database=b,a.Database.drivers={}}(window),function(a){"use strict";a.extend=function(a,b){if(a=a||{},arguments.length>2)for(var c=1;c<arguments.length;c++)window.extend(a,arguments[c]);else for(var d in b)a[d]=b[d];return a}}(window),function(a){"use strict";var b=function(b){if(this.conf=a.extend({name:"",storage:a.localStorage},b||{}),"function"!=typeof b.storage.getItem||"function"!=typeof b.storage.removeItem||"function"!=typeof b.storage.setItem)throw"Given Storage doesn't have methods `getItem`, `setItem` and `removeItem`."};b.prototype.setItem=function(a,b){return this.conf.storage.setItem(this.conf.name+":"+a,JSON.stringify(b))},b.prototype.getItem=function(a){return JSON.parse(this.conf.storage.getItem(this.conf.name+":"+a))},b.prototype.removeItem=function(a){return this.conf.storage.removeItem(this.conf.name+":"+a)},a.Database&&(a.Database.drivers.StorageDriver=b)}(window);